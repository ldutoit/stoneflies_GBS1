#!/bin/sh
files="L1200_V01
L1200_V02
L1200_V03
L1200_V04
L1200_V05
L1200_V06
L1200_V07
L1200_V08
L1200_V09
L1200_V10
L1200_V11
L1200_V12
L320_F01
L320_F02
L320_F03
L320_F04
L320_F05
L435_F01
L435_F02
L435_F03
L435_F04
L435_F05
L435_F06
L435_F07
L435_F08
L435_F09
L435_F10
L435_F11
L435_F12
L435_F13
L435_F14
L435_F15
L435_F16
L435_F17
L550_F01
L550_F02
L550_F03
L550_F04
L550_F05
L550_F06
L550_F07
L550_F08
L550_F09
L550_F10
L550_V01
L550_V02
L700_F01
L700_F02
L700_F03
L700_F04
L700_F05
L700_F06
L700_F07
L700_F08
L700_F09
L700_F10
L700_F11
L700_F12
L700_F13
L700_V01
L700_V02
L700_V03
L700_V04
L700_V05
L700_V06
L700_V07
L700_V08
L700_V09
L700_V10
L700_V11
L700_V12
L700_V13
L700_V14
L700_V15
L700_V16
L850_F01
L850_F02
L850_V01
L850_V02
L850_V03
L850_V04
L850_V05
L850_V06
L850_V09
L850_V10
L850_V11
L850_V12
L850_V13
S1000_V01
S1000_V02
S1000_V03
S1000_V04
S1000_V05
S1000_V06
S1000_V07
S1000_V08
S1000_V09
S1000_V10
S1100_V01
S1100_V02
S1100_V03
S1100_V04
S1100_V05
S1100_V06
S1100_V07
S1100_V08
S1100_V09
S1100_V10
S390_F01
S390_F02
S390_F03
S390_F04
S390_F05
S390_F06
S390_F07
S390_F08
S390_F09
S390_F10
S480_F01
S480_F02
S480_F03
S480_F04
S480_F05
S480_F06
S480_F07
S480_F08
S480_F09
S480_F10
S600_F01
S600_F02
S600_F03
S600_F04
S600_F05
S600_F06
S600_F07
S600_F08
S600_V01
S680_F01
S680_F02
S680_F03
S680_F04
S680_F05
S680_F06
S680_F07
S680_F08
S680_F09
S680_F10
S680_V01
S680_V02
S680_V03
S680_V04
S680_V05
S680_V06
S680_V07
S680_V08
S680_V09
S680_V10
S800_F01
S800_F02
S800_F03
S800_V02
S800_V03
S800_V04
S800_V05
S800_V06
S800_V07
S880_V01
S880_V02
S880_V03
S880_V04
S880_V05
S880_V06
S880_V07
S880_V08
S880_V09
S880_V10
L850_V07
L850_V08
S680_D"

module load BWA SAMtools
#mkdir alignment
#cd alignment
src=../samples/
bwa_db=stoneflygenomeassemblyv1.fasta
for sample in $files
do
	echo $sample
    bwa mem -t 8 $bwa_db $src/${sample}.fq.gz  |   samtools view -b | samtools sort - -threads 8 > ${sample}.bam
done
cd ..

module load Stacks # v2.53

ref_map.pl --samples alignment --popmap popmap_all.txt -T 8  -o output_refmap/
populations -P output_refmap/ -M popmap179.txt  --vcf --structure --plink --treemix --max-obs-het 0.65 -r 0.75 

#Removed 87077 loci that did not pass sample/population constraints from 100912 loci.
#Kept 13835 loci, composed of 1293456 sites; 8803 of those sites were filtered, 67922 variant sites remained.
#    992665 genomic sites, of which 297252 were covered by multiple loci (29.9%). 
#in output_aligned in a few different format
